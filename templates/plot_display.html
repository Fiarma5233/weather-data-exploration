{% extends "base.html" %}

{% block content %}
<div class="container-fluid px-0 mx-0">
    <!-- Message Container -->
    <div id="messageContainer" class="container-fluid px-4" style="display: none;">
        <div class="alert alert-dismissible fade show mb-2" role="alert">
            <span id="messageContent"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>

    <!-- Header with centered title and side buttons -->
    <div class="container-fluid px-4 pt-2">
        <div class="row align-items-center">
            <div class="col-4 text-start">
                <a href="{{ url_for('visualisations_options') }}" 
                   class="btn btn-back-custom">
                    <i class="fas fa-arrow-left me-1"></i> Retour
                </a>
            </div>
            <div class="col-4 text-center">
                <h2 class="h4 mb-0 text-dark">{{ title }}</h2>
            </div>
            <div class="col-4 text-end">
                <button id="resetBtn" class="btn btn-outline-danger">
                    <i class="fas fa-redo me-1"></i> Réinitialiser
                </button>
            </div>
        </div>
    </div>

    <!-- Full-width plot container -->
    <div class="container-fluid px-0 mx-0 mt-3">
        <div class="d-flex justify-content-center align-items-center w-100" style="min-height: 70vh;">
            <div class="w-100 px-3" style="overflow: auto;">
                {{ plot_html|safe }}
            </div>
        </div>
    </div>
</div>

<style>
    .js-plotly-plot .plot-container {
        width: 100% !important;
        height: auto !important;
    }
    
    /* Style personnalisé pour le bouton Retour */
    .btn-back-custom {
        color: #0d6efd; /* Texte bleu */
        border: 1px solid #0d6efd; /* Bordure bleue */
        background-color: white; /* Fond blanc */
        transition: all 0.2s ease;
    }
    
    .btn-back-custom:hover {
        color: white !important; /* Texte blanc au survol */
        background-color: #0d6efd; /* Fond bleu au survol */
    }

    #messageContainer {
        transition: all 0.3s ease;
    }

    .alert {
        border-radius: 0;
        border-left: none;
        border-right: none;
    }

    @media (max-width: 768px) {
        .row.align-items-center > div {
            padding: 0.5rem !important;
        }
        .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
    }
</style>

<!-- Le reste du JavaScript reste inchangé -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const messageContainer = document.getElementById('messageContainer');
    const messageContent = document.getElementById('messageContent');
    const alertBox = messageContainer.querySelector('.alert');

    function showMessage(message, type = 'danger') {
        alertBox.className = `alert alert-${type} alert-dismissible fade show mb-2`;
        messageContent.innerHTML = message;
        messageContainer.style.display = 'block';
        
        setTimeout(() => {
            const bsAlert = new bootstrap.Alert(alertBox);
            bsAlert.close();
        }, 5000);
    }

    document.getElementById('resetBtn').addEventListener('click', function() {
        const confirmMessage = document.createElement('div');
        confirmMessage.innerHTML = `
            <p>Êtes-vous sûr de vouloir réinitialiser toutes les données ?</p>
            <div class="mt-3 d-flex justify-content-end gap-2">
                <button class="btn btn-sm btn-outline-secondary" id="cancelReset">Annuler</button>
                <button class="btn btn-sm btn-danger" id="confirmReset">Confirmer</button>
            </div>
        `;

        showMessage(confirmMessage.innerHTML, 'warning');

        document.getElementById('cancelReset').addEventListener('click', () => {
            const bsAlert = new bootstrap.Alert(alertBox);
            bsAlert.close();
        });

        document.getElementById('confirmReset').addEventListener('click', () => {
            showMessage('<i class="fas fa-spinner fa-spin me-2"></i> Réinitialisation en cours...', 'info');

            fetch("{{ url_for('reset_data') }}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    showMessage(`<i class="fas fa-check-circle me-2"></i> ${data.message || 'Réinitialisation réussie'}`, 'success');
                    setTimeout(() => window.location.reload(), 2000);
                } else {
                    showMessage(`<i class="fas fa-exclamation-circle me-2"></i> ${data.message || 'Erreur lors de la réinitialisation'}`, 'danger');
                }
            })
            .catch(error => {
                showMessage(`<i class="fas fa-exclamation-circle me-2"></i> Erreur réseau: ${error.message}`, 'danger');
            });
        });
    });

    alertBox.addEventListener('closed.bs.alert', () => {
        messageContainer.style.display = 'none';
    });
});
</script>
{% endblock %}